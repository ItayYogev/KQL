union DeviceTvmSoftwareVulnerabilities, CloudAppEvents
| join kind=inner (DeviceTvmSoftwareVulnerabilitiesKB) on CveId
| where VulnerabilitySeverityLevel == 'High' or VulnerabilitySeverityLevel == 'Critical'
| where SoftwareName contains "windows" or SoftwareName contains "macos" or SoftwareName contains "linux"
| summarize cve_count = dcount(CveId) by DeviceId, DeviceName
| project DeviceName, cve_count
| order by cve_count desc 